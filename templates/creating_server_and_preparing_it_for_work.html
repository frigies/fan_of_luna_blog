{% extends "base.html" %}

{% block title %}creating_server_and_preparing_it_for_work{% endblock %}
{% block head %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for ('static', filename='css/creating_server_and_preparing_it_for_work.css') }}">
{% endblock %}
{% block content %}
<section id="процесс-создания-сервера" class="level1">
<h1>Процесс создания сервера</h1>
<section id="генерируем-ssh-ключ-на-своём-компьютере" class="level2">
<h2>1. Генерируем ssh-ключ на своём компьютере:</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh-keygen</span> <span class="at">-t</span> ed25519 <span class="at">-a</span> 100 <span class="at">-C</span> comment <span class="at">-f</span> filename</span></code></pre></div>
</section>
<section id="покупаем-vds-сервер-на-хостинге" class="level2">
<h2>2. Покупаем VDS-сервер на хостинге</h2>
<p>Стоит покупать сервер под операционной системой Ubuntu Server 22.10, 23.04, 23.10, 24.04 или Debian 12</p>
</section>
<section id="создаём-в-файле-.sshconfig-запись-для-нового-хостинга-указав-в-качестве-пользователя-root-и-preferredauthentications-password" class="level2">
<h2>3. Создаём в файле ~/.ssh/config запись для нового хостинга, указав в качестве пользователя root и PreferredAuthentications password</h2>
</section>
<section id="подключаемся-к-хостингу-по-имени-созданному-на-4-м-шаге-создаём-нового-пользователя-и-даём-ему-привилегии-sudo" class="level2">
<h2>4. Подключаемся к хостингу по имени, созданному на 4-м шаге, создаём нового пользователя и даём ему привилегии sudo:</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> adduser frigies</span></code></pre></div>
<p>Если получаем ошибку “-bash: sudo: command not found”, то</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">apt</span> update <span class="kw">&amp;&amp;</span> <span class="ex">apt</span> install sudo</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">usermod</span> <span class="at">-aG</span> sudo frigies</span></code></pre></div>
</section>
<section id="загружаем-публичный-ssh-ключ-на-сервер" class="level2">
<h2>5. Загружаем публичный ssh-ключ на сервер:</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ssh-copy-id</span> <span class="at">-i</span> путь_к_файлу_с_ключом frigies@название_сервера</span></code></pre></div>
</section>
<section id="меняем-в-файле-.sshconfig-имя-пользователя-на-frigies-и-вместо-preferredauthentications-password-указываем-identityfile-путь_к_файлу_с_ключом-и-пробуем-подключиться" class="level2">
<h2>6. Меняем в файле ~/.ssh/config имя пользователя на frigies и вместо PreferredAuthentications password указываем IdentityFile путь_к_файлу_с_ключом и пробуем подключиться</h2>
</section>
</section>
<section id="процесс-подготовки-сервера-к-работе" class="level1">
<h1>Процесс подготовки сервера к работе</h1>
<section id="устанавливаем-вспомогательные-пакеты-и-меняем-оболочку-на-zsh" class="level2">
<h2>1. Устанавливаем вспомогательные пакеты и меняем оболочку на zsh:</h2>
<p>Обновляем пакеты:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt update <span class="kw">&amp;&amp;</span> <span class="fu">sudo</span> apt upgrade <span class="at">-y</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install <span class="at">-y</span> tmux neovim bat htop git curl wget unzip zip zsh tree ncdu</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sh</span> <span class="at">-c</span> <span class="st">&quot;</span><span class="va">$(</span><span class="ex">curl</span> <span class="at">-fsSL</span> https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh<span class="va">)</span><span class="st">&quot;</span></span></code></pre></div>
</section>
<section id="настраиваем-редактор-neovim" class="level2">
<h2>2. Настраиваем редактор neovim:</h2>
<p>!пока нерабочая инструкция!</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-fLo</span> ~/.vim/autoload/plug.vim <span class="at">--create-dirs</span> <span class="dt">\</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim</span></code></pre></div>
<p>Открываем файл конфигурации:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">vim</span> ~/.vimrc</span></code></pre></div>
<p>Вносим следующие строки:</p>
<pre><code>call plug#begin()

Plug &#39;preservim/nerdtree&#39;

&quot;colorschemes
Plug &#39;morhetz/gruvbox&#39;

call plug#end()

syntax on
colorscheme gruvbox
set background=dark
set number

&quot;mappings
nnoremap &lt;leader&gt;n :NERDTreeFocus&lt;CR&gt;
nnoremap &lt;C-n&gt; :NERDTree&lt;CR&gt;
nnoremap &lt;C-t&gt; :NERDTreeToggle&lt;CR&gt;
nnoremap &lt;C-f&gt; :NERDTreeFind&lt;CR&gt;</code></pre>
<p>Выполняем команды в командном режиме:</p>
<pre><code>:w
:source ~/.vimrc
:PlugInstall
:source ~/.vimrc</code></pre>
<p>Устанавливаем neovim как редактор по умолчанию:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> update-alternatives <span class="at">--config</span> editor</span></code></pre></div>
<p>Вводим число, соответствующее /usr/bin/nvim</p>
</section>
<section id="настраиваем-tmux" class="level2">
<h2>3. Настраиваем tmux:</h2>
<p>Создаём сессию tmux:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">tmux</span></span></code></pre></div>
<p>Открываем файл конфигурации:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nvim</span> ~/.tmux.conf</span></code></pre></div>
<p>Вносим туда следующую строку:</p>
<pre><code>set -g mouse on</code></pre>
<p>Просим tmux перечитать конфигурацию:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">tmux</span> source-file ~/.tmux.conf</span></code></pre></div>
</section>
<section id="если-собираемся-работать-с-python-и-uv-устанавливаем-их" class="level2">
<h2>4. Если собираемся работать с Python и uv, устанавливаем их:</h2>
<p>Python уже установлен.</p>
<p>Устанавливаем uv:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-LsSf</span> https://astral.sh/uv/install.sh <span class="kw">|</span> <span class="fu">sh</span></span></code></pre></div>
</section>
<section id="если-собираемся-работать-с-node-js-и-npm-устанавливаем-их" class="level2">
<h2>5. Если собираемся работать с Node JS и npm, устанавливаем их:</h2>
<p>Если операционная система слишком старая, то устанавливаем Node JS через NVM:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-o-</span> https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.5/install.sh <span class="kw">|</span> <span class="fu">bash</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">NVM_DIR</span><span class="op">=</span><span class="st">&quot;</span><span class="va">$(</span><span class="bu">[</span> <span class="ot">-z</span> <span class="st">&quot;</span><span class="va">${XDG_CONFIG_HOME</span><span class="op">-</span><span class="va">}</span><span class="st">&quot;</span> <span class="bu">]</span> <span class="kw">&amp;&amp;</span> <span class="bu">printf</span> %s <span class="st">&quot;</span><span class="va">${HOME}</span><span class="st">/.nvm&quot;</span> <span class="kw">||</span> <span class="bu">printf</span> %s <span class="st">&quot;</span><span class="va">${XDG_CONFIG_HOME}</span><span class="st">/nvm&quot;</span><span class="va">)</span><span class="st">&quot;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> <span class="ot">-s</span> <span class="st">&quot;</span><span class="va">$NVM_DIR</span><span class="st">/nvm.sh&quot;</span> <span class="bu">]</span> <span class="kw">&amp;&amp;</span> <span class="ex">\.</span> <span class="st">&quot;</span><span class="va">$NVM_DIR</span><span class="st">/nvm.sh&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nvm</span> install 20</span></code></pre></div>
<p>Для новых систем просто устанавливаем Node JS через стандартный менеджер пакетов:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install nodejs npm</span></code></pre></div>
<p>Проверяем версии Node JS и NPM:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">node</span> <span class="at">-v</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> <span class="at">-v</span></span></code></pre></div>
<p>Версия Node JS должна быть не ниже 16.</p>
</section>
<section id="устаналиваем-временную-зону-и-локаль-если-необходимо" class="level2">
<h2>6. Устаналиваем временную зону и локаль, если необходимо:</h2>
<p>Установка временной зоны:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> timedatectl set-timezone UTC</span></code></pre></div>
<p>Установка локали:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> dpkg-reconfigure locales</span></code></pre></div>
<p>Выбираем для установки локали “en_US.UTF-8 UTF-8” и “ru_RU.UTF-8 UTF-8” и в качестве локали по умолчанию выбираем “ru_RU.UTF-8 UTF-8”</p>
</section>
<section id="если-собираемся-работать-с-supervisor-устанавливаем-и-настраиваем-его" class="level2">
<h2>7. Если собираемся работать с supervisor, устанавливаем и настраиваем его:</h2>
<p>Создаём папку для логов:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mkdir <span class="at">-p</span> /var/log/supervisor</span></code></pre></div>
<p>Устанавливаем:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install supervisor</span></code></pre></div>
<p>Открываем файл конфигурации:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> nvim /etc/supervisor/supervisord.conf</span></code></pre></div>
<p>Вставляем после секции <em>[unix_http_server]</em> следующую секцию:</p>
<pre><code>[inet_http_server]
port=0.0.0.0:9988
username=frigies
password=пароль_для_супервизора</code></pre>
<p>Выполняем:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl restart supervisor</span></code></pre></div>
<p>Проверяем статус:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl status supervisor</span></code></pre></div>
<p>Если всё ок:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl enable supervisor</span></code></pre></div>
</section>
<section id="перезагружаем-сервер" class="level2">
<h2>8. Перезагружаем сервер:</h2>
<div class="sourceCode" id="cb32"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> reboot</span></code></pre></div>
</section>
</section>
{% endblock %}
